// Generated by CoffeeScript 1.6.2
var __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

define(["a/Pi", "lib/jquery-ui"], function(aPi, jQueryUI) {
  var TypeaheadPair, _ref;
  return TypeaheadPair = (function(_super) {
    __extends(TypeaheadPair, _super);

    function TypeaheadPair() {
      _ref = TypeaheadPair.__super__.constructor.apply(this, arguments);
      return _ref;
    }

    TypeaheadPair.prototype.attr = function() {
      return TypeaheadPair.__super__.attr.apply(this, arguments).concat(["uri", "msg"]);
    };

    TypeaheadPair.prototype.init = function() {
      var args, o,
        _this = this;
      this.bindKeys();
      args = {};
      args.minLength = 0;
      o = this;
      args.source = function(request, response) {
        return $.ajax({
          url: _this.a.uri,
          dataType: "json",
          type: "POST",
          data: {
            packet: JSON.stringify({
              args: {
                term: request.term
              },
              data: _this.data,
              query: _this.rt.uri.query(true)
            })
          },
          success: function(data) {
            return response(data);
          }
        });
      };
      args.search = function(ev, ui) {
        var term;
        if ($(this).attr("keyCode") === "39") {
          return true;
        }
        term = this.value.split(/,\s*/).pop();
        if (term.length < 3) {
          return false;
        }
      };
      args.focus = function() {
        return false;
      };
      args.select = function(ev, ui) {
        var terms;
        terms = this.value.split(/,\s*/);
        terms.pop();
        terms.push(ui.item.label);
        this.value = terms.join(", ");
        $(this).attr("item_val", ui.item.value);
        if (o.a.msg) {
          o.pub(o.a.msg, ui.item);
        }
        return false;
      };
<<<<<<< HEAD
      args.close = function(ev, ui) {};
=======
>>>>>>> 15d2ba4a642d7bd1c1689ca59e48e323b79a380f
      return this.e.autocomplete(args);
    };

    TypeaheadPair.prototype.bindKeys = function() {
      return this.e.bind("keydown", function(ev) {
        var _ref1, _ref2;
        $(this).attr("keyCode", ev.keyCode);
        if (ev.keyCode === $.ui.keyCode.TAB && ((_ref1 = $(this).data("autocomplete")) != null ? (_ref2 = _ref1.menu) != null ? _ref2.active : void 0 : void 0)) {
          ev.preventDefault();
        }
        if (ev.keyCode === $.ui.keyCode.RIGHT) {
          return $(this).autocomplete("search");
        }
      });
    };

    return TypeaheadPair;

  })(aPi);
});
